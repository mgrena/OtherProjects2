@page "/entryQ/treat/{questionnaireId:int}"

@using Krka.MoveOn.Data.Questionnaires
@using Krka.MoveOn.Services
@using Krka.MoveOn.Services.Questionnaires

@attribute [StreamRendering(true)]
@rendermode InteractiveServer

@inject Treatment03Service TreatmentService


<PageTitle>MoveOn - Liečba pridružených problémov </PageTitle>

<div class="cw-880" style="width: 70%; margin: 0 auto;">
    <_EntryBtn />

    <div style="background-color: #f2f2f2; color: #363c41; padding: 5px; border-radius: 2px; text-align: left; font-weight: bold;">
        Liečba pridružených problémov (napr. obstipácia, depresia, kognitívne poruchy atď.):
    </div>
    <DxGrid @ref="treatGrid"
            Data="Treats"
            PageSize="20"
            PagerPosition="GridPagerPosition.Bottom"
            PageSizeSelectorVisible="true"
            PageSizeSelectorItems="@(new int[] { 10, 20, 100 })"
            PageSizeSelectorAllRowsItemVisible="true"
            PagerSwitchToInputBoxButtonCount="10"
            PagerVisibleNumericButtonCount="10"
            KeyFieldName="Id"
            ValidationEnabled="false"
            EditMode="GridEditMode.EditCell"
            FilterMenuButtonDisplayMode="GridFilterMenuButtonDisplayMode.Always"
            ColumnResizeMode="GridColumnResizeMode.NextColumn"
            TextWrapEnabled="false"
            HighlightRowOnHover="true"
            FocusedRowEnabled="true">

        <ToolbarTemplate Context="toolbarContext">
            <DxToolbar ItemRenderStyleMode="ToolbarRenderStyleMode.Plain">

                <DxToolbarItem Text="Pridať učinnú látku" Enabled="true" Click="New_Click">
                    <img src="images/pill.svg" width="24" height="24" alt="Pridať učinnu látku" />
                    <span style="margin-left: 2px">Pridať učinnú látku</span>
                </DxToolbarItem>

                <DxToolbarItem Text="Uložiť" BeginGroup="true">
                    <img src="images/save.svg" width="24" height="24" alt="Save" />
                    <span style="margin-left: 3px">Uložiť</span>
                </DxToolbarItem>

                <DxToolbarItem Text="Zrušiť">
                    <img src="images/cancel.svg" width="24" height="24" alt="Cancel" />
                    <span style="margin-left: 4px">Zrušiť</span>
                </DxToolbarItem>
            </DxToolbar>
        </ToolbarTemplate>

        <Columns>
            <DxGridDataColumn FieldName="Treat_1" Caption="Učinná látka">
                <EditSettings>
                    <DxComboBoxSettings Data="@treat_1_Answer" ValueFieldName="Id" TextFieldName="Name" />
                </EditSettings>
            </DxGridDataColumn>

            <DxGridDataColumn FieldName="Treat_2" Caption="Dávka (mg)" />

            <DxGridDataColumn FieldName="Treat_3" Caption="Indikácia" >
                <EditSettings>
                    <DxComboBoxSettings Data="@treat_3_Answer" ValueFieldName="Id" TextFieldName="Name" />
                </EditSettings>
            </DxGridDataColumn>          
        </Columns>     
    </DxGrid>
</div>




@code {
    [Parameter]
    public int questionnaireId { get; set; }

    IGrid treatGrid { get; set; }
    public List<Data.Questionnaires.QuestionnaireTreatment03> Treats { get; set; }

    List<Data.Dials.DialActiveIngredient> dialActiveIngredient = new();
    List<Data.Dials.DialActiveIngredient> treat_1_Answer = new();

    List<Data.Dials.DialIndication> dialIndication = new();
    List<Data.Dials.DialIndication> treat_3_Answer = new();

    protected override async Task OnInitializedAsync()
    {
        Treats = await TreatmentService.GetQuestionnaireTreatment03(questionnaireId);

        dialActiveIngredient = await TreatmentService.GetDialActiveIngredientAsync();
        treat_1_Answer = dialActiveIngredient.Where(d => d.Type_q == 1).ToList();

        dialIndication = await TreatmentService.GetDialIndicationAsync();
        treat_3_Answer = dialIndication.Where(d => d.Type_q == 1).ToList();

    }

    async Task New_Click() => await treatGrid.StartEditNewRowAsync();
}