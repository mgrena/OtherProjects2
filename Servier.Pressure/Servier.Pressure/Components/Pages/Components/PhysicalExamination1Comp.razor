@using Servier.Pressure.Components.Account.Shared
@using Servier.Pressure.Data.Models
@using Servier.Pressure.Data.Lists
@using Servier.Pressure.Services.Pages

@attribute [StreamRendering(true)]
@rendermode InteractiveServer

@inject QuestionnaireService QuestionnaireService
@inject IToastNotificationService ToastService

@if (PhysicalExamination == null)
{
    <p><em>Načítavanie...</em></p>
}
else
{
    <EditForm Model="@PhysicalExamination" Context="EditFormContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutGroup Caption="Fyzikálne vyšetrenie" ColSpanMd="12" CaptionCssClass="caption-styleH0">
                <DxFormLayoutGroup Caption="Výška, hmotnosť, BMI a obvod pása" ColSpanMd="12">
                    <DxFormLayoutItem Caption="výška" ColSpanMd="8" CaptionCssClass="caption-styleH1">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Height" Mask="999.9" />
                                <span style="margin-left: 5px;">cm</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="neznáma" ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@HeightUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="hmotnosť" ColSpanMd="8" CaptionCssClass="caption-styleH1">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Weight" Mask="999.9" />
                                <span style="margin-left: 5px;">kg</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="neznáma" ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@WeightUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="BMI" ColSpanMd="8" CaptionCssClass="caption-styleH1-blue"><span style="color:#6e7de8;">@BMI</span></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="automaticky počítané" ColSpanMd="4" CaptionCssClass="caption-styleH1-blue"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="obvod pása" ColSpanMd="8" CaptionCssClass="caption-styleH1">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Waist" Mask="999" />
                                <span style="margin-left: 5px;">cm</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="neznámy" ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@WaistUnknown" />
                    </DxFormLayoutItem>
                </DxFormLayoutGroup>
                <DxFormLayoutGroup Caption="Tlak krvi a pulz (merané na návšteve 1)" ColSpanMd="12">
                    <DxFormLayoutItem ColSpanMd="12" CaptionCssClass="caption-styleH1">
                        <Template>
                            <DxRadioGroup Layout="@RadioGroupLayout.Horizontal" Items="@Hands" @bind-Value="@Hand" />
                            <p><i><strong>Poznámka:</strong> Prosím, uvádzajte hodnoty namerané na ruke s vyšším krvným tlakom.</i></p>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="1. meranie" ColSpanMd="8" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené" ColSpanMd="4" CaptionCssClass="caption-styleH1 long-caption">
                        <DxCheckBox @bind-Checked="@Measurement1" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="tlak krvi" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement1Stk" Mask="999" />
                                <span>/</span>
                                <DxMaskedInput @bind-Value="@Measurement1Dtk" Mask="999" />
                                <span> mmHg</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="pulz" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement1Sf" Mask="999" />
                                <span> úderov za minútu</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem ColSpanMd="12" CssClass="form-separator"><Template><hr /></Template></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="2. meranie" ColSpanMd="8" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené" ColSpanMd="4" CaptionCssClass="caption-styleH1 long-caption">
                        <DxCheckBox @bind-Checked="@Measurement2" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="tlak krvi" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement2Stk" Mask="999" />
                                <span>/</span>
                                <DxMaskedInput @bind-Value="@Measurement2Dtk" Mask="999" />
                                <span> mmHg</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="pulz" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement2Sf" Mask="999" />
                                <span> úderov za minútu</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem ColSpanMd="12" CssClass="form-separator"><Template><hr /></Template></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="3. meranie" ColSpanMd="8" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené" ColSpanMd="4" CaptionCssClass="caption-styleH1 long-caption">
                        <DxCheckBox @bind-Checked="@Measurement3" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="tlak krvi" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement3Stk" Mask="999" />
                                <span>/</span>
                                <DxMaskedInput @bind-Value="@Measurement3Dtk" Mask="999" />
                                <span> mmHg</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="1" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="pulz" ColSpanMd="7" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div class="d-flex align-items-center gap-2">
                                <DxMaskedInput @bind-Value="@Measurement3Sf" Mask="999" />
                                <span> úderov za minútu</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="4" CaptionCssClass="caption-styleH1"></DxFormLayoutItem>
                    <DxFormLayoutItem ColSpanMd="12" CssClass="form-separator"><Template><hr /></Template></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="priemerný tlak krvi" ColSpanMd="6" CaptionCssClass="caption-styleH1-blue long-caption"><span style="color:#6e7de8;">@MeasurementStk / @MeasurementDtk mmHg</span></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="6" CaptionCssClass="caption-styleH1-blue"><span style="color:#6e7de8;">autom. počítaný</span></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="priemerný pulz" ColSpanMd="6" CaptionCssClass="caption-styleH1-blue long-caption"><span style="color:#6e7de8;">@MeasurementSf úderov za minútu</span></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="" ColSpanMd="6" CaptionCssClass="caption-styleH1-blue"><span style="color:#6e7de8;">z meraní č. 2 a 3</span></DxFormLayoutItem>
                </DxFormLayoutGroup>
            </DxFormLayoutGroup>
        </DxFormLayout>
    </EditForm>
    <StatusMessage Message="@Message" />
}
@if (LaboratoryTest == null)
{
    <p><em>Načítavanie...</em></p>
}
else
{
    <EditForm Model="@LaboratoryTest" Context="EditFormContext">
        <DxFormLayout CssClass="w-100">
            <DxFormLayoutGroup Caption="Výsledky laboratórnych vyšetrení" ColSpanMd="12" CaptionCssClass="caption-styleH0">
                <DxFormLayoutGroup Caption="Výsledky posledných biochemických vyšetrení (nie starších ako 3 mesiace)" ColSpanMd="12">
                    <DxFormLayoutItem Caption="celk. cholesterol" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Cholesterol" Mask="999.9" />
                                <span style="margin-left: 5px;">mmol/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@CholesterolUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="LDL" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@LDL" Mask="999.9" />
                                <span style="margin-left: 5px;">mmol/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@LDLUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="HDL" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@HDL" Mask="999.9" />
                                <span style="margin-left: 5px;">mmol/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@HDLUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="non-HDL" ColSpanMd="8" CaptionCssClass="caption-styleH1-blue long-caption"><span style="color:#6e7de8;">@NonHDL</span></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="autom. počítaný (vzorec: celk. cholesterol – HDL)" ColSpanMd="4" CaptionCssClass="caption-styleH1-blue"></DxFormLayoutItem>
                    <DxFormLayoutItem Caption="triglyceridy" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Triglycerides" Mask="999.9" />
                                <span style="margin-left: 5px;">mmol/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@TriglyceridesUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="albumín" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Albumin" Mask="999.9" />
                                <span style="margin-left: 5px;">g/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@AlbuminUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="kreatinín" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Creatinine" Mask="999.9" />
                                <span style="margin-left: 5px;">μmo/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@CreatinineUnknown" />
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="glykémia (nalačno)" ColSpanMd="8" CaptionCssClass="caption-styleH1 long-caption">
                        <Template>
                            <div style="display: flex; align-items: center;">
                                <DxMaskedInput @bind-Value="@Glycemia" Mask="999.9" />
                                <span style="margin-left: 5px;">mmol/l</span>
                            </div>
                        </Template>
                    </DxFormLayoutItem>
                    <DxFormLayoutItem Caption="nevyšetrené alebo neznáme " ColSpanMd="4" CaptionCssClass="caption-styleH1">
                        <DxCheckBox @bind-Checked="@GlycemiaUnknown" />
                    </DxFormLayoutItem>
                </DxFormLayoutGroup>
            </DxFormLayoutGroup>
        </DxFormLayout>
    </EditForm>
}

@code {
    [Parameter]
    public required string patientId { get; set; }

    private PhysicalExamination1? PhysicalExamination { get; set; }
    private LaboratoryTest? LaboratoryTest { get; set; }
    private IEnumerable<string> Hands = new[] { "pravá ruka", "ľavá ruka" };
    private string? Message;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            PhysicalExamination = await QuestionnaireService.GetPhysicalExamination1ByIdAsync(patientId);
            LaboratoryTest = await QuestionnaireService.GetLaboratoryTestByIdAsync(patientId);
            await InvokeAsync(StateHasChanged);
        }
    }

    private System.Timers.Timer? debouncePETimer;
    private async Task OnPEFieldChangedAsync()
    {
        // Ak existuje starý timer, zastaviť ho
        debouncePETimer?.Stop();

        // Nový timer na 1 sekundu
        debouncePETimer = new System.Timers.Timer(1000);
        debouncePETimer.AutoReset = false;
        debouncePETimer.Elapsed += async (s, e) =>
        {
            var result = await QuestionnaireService.SavePhysicalExamination1Async(PhysicalExamination!);
            if (!result.Success)
                Message = string.Format("Chyba: {0} {1}", result.ErrorMessage, result.AdditionalInfo);
            else
                ModifyToast();
        };
        debouncePETimer.Start();

        // Await the timer to avoid CS1998 warning
        await Task.CompletedTask;
    }
    private System.Timers.Timer? debounceLTTimer;
    private async Task OnLTFieldChangedAsync()
    {
        // Ak existuje starý timer, zastaviť ho
        debounceLTTimer?.Stop();

        // Nový timer na 1 sekundu
        debounceLTTimer = new System.Timers.Timer(1000);
        debounceLTTimer.AutoReset = false;
        debounceLTTimer.Elapsed += async (s, e) =>
        {
            var result = await QuestionnaireService.SaveLaboratoryTestAsync(LaboratoryTest!);
            if (!result.Success)
                Message = string.Format("Chyba: {0} {1}", result.ErrorMessage, result.AdditionalInfo);
            else
                ModifyToast();
        };
        debounceLTTimer.Start();

        // Await the timer to avoid CS1998 warning
        await Task.CompletedTask;
    }

    private string Height
    {
        get => PhysicalExamination?.Height.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Height != newValue)
            {
                PhysicalExamination!.Height = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool HeightUnknown
    {
        get => PhysicalExamination!.HeightUnknown;
        set
        {
            if (PhysicalExamination!.HeightUnknown != value)
            {
                PhysicalExamination!.HeightUnknown = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Weight
    {
        get => PhysicalExamination?.Weight.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Weight != newValue)
            {
                PhysicalExamination!.Weight = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool WeightUnknown
    {
        get => PhysicalExamination!.WeightUnknown;
        set
        {
            if (PhysicalExamination!.WeightUnknown != value)
            {
                PhysicalExamination!.WeightUnknown = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string BMI
    {
        get
        {
            if (PhysicalExamination?.Height == 0)
                return "0 kg/m2";
            else
                return (PhysicalExamination!.Weight / ((PhysicalExamination!.Height / 100) * (PhysicalExamination!.Height / 100))).ToString("F2") + " kg/m2";
        }
    }
    private string Waist
    {
        get => PhysicalExamination?.Waist.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Waist != newValue)
            {
                PhysicalExamination!.Waist = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool WaistUnknown
    {
        get => PhysicalExamination!.WaistUnknown;
        set
        {
            if (PhysicalExamination!.WaistUnknown != value)
            {
                PhysicalExamination!.WaistUnknown = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Hand
    {
        get => (PhysicalExamination!.Hand == HandEnum.right) ? "pravá ruka" : "ľavá ruka";
        set
        {
            HandEnum hand = (value == "pravá ruka") ? HandEnum.right : HandEnum.left;
            if (PhysicalExamination!.Hand != hand)
            {
                PhysicalExamination!.Hand = hand;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool Measurement1
    {
        get => PhysicalExamination!.Measurement1;
        set
        {
            if (PhysicalExamination!.Measurement1 != value)
            {
                PhysicalExamination!.Measurement1 = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement1Stk
    {
        get => PhysicalExamination?.Measurement1Stk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement1Stk != newValue)
            {
                PhysicalExamination!.Measurement1Stk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement1Dtk
    {
        get => PhysicalExamination?.Measurement1Dtk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement1Dtk != newValue)
            {
                PhysicalExamination!.Measurement1Dtk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement1Sf
    {
        get => PhysicalExamination?.Measurement1Sf.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement1Sf != newValue)
            {
                PhysicalExamination!.Measurement1Sf = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool Measurement2
    {
        get => PhysicalExamination!.Measurement2;
        set
        {
            if (PhysicalExamination!.Measurement2 != value)
            {
                PhysicalExamination!.Measurement2 = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement2Stk
    {
        get => PhysicalExamination?.Measurement2Stk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement2Stk != newValue)
            {
                PhysicalExamination!.Measurement2Stk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement2Dtk
    {
        get => PhysicalExamination?.Measurement2Dtk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement2Dtk != newValue)
            {
                PhysicalExamination!.Measurement2Dtk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement2Sf
    {
        get => PhysicalExamination?.Measurement2Sf.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement2Sf != newValue)
            {
                PhysicalExamination!.Measurement2Sf = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private bool Measurement3
    {
        get => PhysicalExamination!.Measurement3;
        set
        {
            if (PhysicalExamination!.Measurement3 != value)
            {
                PhysicalExamination!.Measurement3 = value;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement3Stk
    {
        get => PhysicalExamination?.Measurement3Stk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement3Stk != newValue)
            {
                PhysicalExamination!.Measurement3Stk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement3Dtk
    {
        get => PhysicalExamination?.Measurement3Dtk.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement3Dtk != newValue)
            {
                PhysicalExamination!.Measurement3Dtk = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string Measurement3Sf
    {
        get => PhysicalExamination?.Measurement3Sf.ToString() ?? string.Empty;
        set
        {
            int newValue = 0;
            if (int.TryParse(value, out var parsed))
                newValue = parsed;
            if (PhysicalExamination!.Measurement3Sf != newValue)
            {
                PhysicalExamination!.Measurement3Sf = newValue;
                InvokeAsync(OnPEFieldChangedAsync);
            }
        }
    }
    private string MeasurementStk { get => ((PhysicalExamination!.Measurement1Stk + PhysicalExamination!.Measurement2Stk + PhysicalExamination!.Measurement3Stk) / 3m).ToString("F2"); }
    private string MeasurementDtk { get => ((PhysicalExamination!.Measurement1Dtk + PhysicalExamination!.Measurement2Dtk + PhysicalExamination!.Measurement3Dtk) / 3m).ToString("F2"); }
    private string MeasurementSf { get => ((PhysicalExamination!.Measurement2Sf + PhysicalExamination!.Measurement3Sf) / 2m).ToString("F2"); }

    private string Cholesterol
    {
        get => LaboratoryTest?.Cholesterol.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.Cholesterol != newValue)
            {
                LaboratoryTest!.Cholesterol = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool CholesterolUnknown
    {
        get => LaboratoryTest!.CholesterolUnknown;
        set
        {
            if (LaboratoryTest!.CholesterolUnknown != value)
            {
                LaboratoryTest!.CholesterolUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string LDL
    {
        get => LaboratoryTest?.LDL.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.LDL != newValue)
            {
                LaboratoryTest!.LDL = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool LDLUnknown
    {
        get => LaboratoryTest!.LDLUnknown;
        set
        {
            if (LaboratoryTest!.LDLUnknown != value)
            {
                LaboratoryTest!.LDLUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string HDL
    {
        get => LaboratoryTest?.HDL.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.HDL != newValue)
            {
                LaboratoryTest!.HDL = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool HDLUnknown
    {
        get => LaboratoryTest!.HDLUnknown;
        set
        {
            if (LaboratoryTest!.HDLUnknown != value)
            {
                LaboratoryTest!.HDLUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string NonHDL { get => (LaboratoryTest!.Cholesterol - LaboratoryTest!.HDL).ToString("F2") + " mmol/l"; }
    private string Triglycerides
    {
        get => LaboratoryTest?.Triglycerides.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.Triglycerides != newValue)
            {
                LaboratoryTest!.Triglycerides = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool TriglyceridesUnknown
    {
        get => LaboratoryTest!.TriglyceridesUnknown;
        set
        {
            if (LaboratoryTest!.TriglyceridesUnknown != value)
            {
                LaboratoryTest!.TriglyceridesUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string Albumin
    {
        get => LaboratoryTest?.Albumin.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.Albumin != newValue)
            {
                LaboratoryTest!.Albumin = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool AlbuminUnknown
    {
        get => LaboratoryTest!.AlbuminUnknown;
        set
        {
            if (LaboratoryTest!.AlbuminUnknown != value)
            {
                LaboratoryTest!.AlbuminUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string Creatinine
    {
        get => LaboratoryTest?.Creatinine.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.Creatinine != newValue)
            {
                LaboratoryTest!.Creatinine = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool CreatinineUnknown
    {
        get => LaboratoryTest!.CreatinineUnknown;
        set
        {
            if (LaboratoryTest!.CreatinineUnknown != value)
            {
                LaboratoryTest!.CreatinineUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private string Glycemia
    {
        get => LaboratoryTest?.Glycemia.ToString() ?? string.Empty;
        set
        {
            decimal newValue = 0;
            if (decimal.TryParse(value, out var parsed))
                newValue = parsed;
            if (LaboratoryTest!.Glycemia != newValue)
            {
                LaboratoryTest!.Glycemia = newValue;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }
    private bool GlycemiaUnknown
    {
        get => LaboratoryTest!.GlycemiaUnknown;
        set
        {
            if (LaboratoryTest!.GlycemiaUnknown != value)
            {
                LaboratoryTest!.GlycemiaUnknown = value;
                InvokeAsync(OnLTFieldChangedAsync);
            }
        }
    }

    private void ModifyToast()
    {
        ToastService.ShowToast(new ToastOptions
            {
                ProviderName = "Overview",
                Title = "Údaje úspešne aktualizované",
                ThemeMode = ToastThemeMode.Saturated,
                RenderStyle = ToastRenderStyle.Success,
            });
    }
}
